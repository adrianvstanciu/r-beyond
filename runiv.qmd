# R universe {#sec-runiv}

```{r,echo=FALSE,include=FALSE}
library(tidyverse)
```

```{r runiv, out.width='50%', fig.asp=.75, fig.align='center',echo=FALSE}
knitr::include_graphics("img/runiv.jpg")
```

To paraphrase, _R_ is a dialect of another programming language, namely _S_. You can read more about the history of _R_ (and _S_) [here](https://bookdown.org/rdpeng/rprogdatascience/history-and-overview-of-r.html). Long story short, _R_ is a programming language derived from _S_ that was available only for commercial packages. _R_ was created by **Ross Ihaka** and **Robert Gentleman** in 1991 at the University of Auckland, New Zealand. In 1995, it became an open source code thanks to contributions by **Martin Mächler**.

In this short book, I will use interchangeably `r` and _R_.

The online and free book by **Roger D. Peng** [_R programming for data science_](https://bookdown.org/rdpeng/rprogdatascience/) is a good further reading for those interested. 

The online and free book by **Oscar Baruffa** [_Big book of R_](https://www.bigbookofr.com/) is an excelent collection of available resources to learn and master _R_. 

## R (the console and language) {-} 

![The _R_ console](img/rconsole.png){.lightbox width=50% #fig-rconsole}

When most people talk about `r` they mean both the programming language and a console. Unless they are IT experts who can make the distinction with ease. But, for the purpose of the seminar, or as a typical `r`-user for what is worth, it really doesn't matter. 

When working with `r` one needs a designated console for writing the code, and this is easy to detect as `r`-console (see Figure @fig-rconsole). 

To download _R_, go to the [cran](https://cran.r-project.org/) website and select the file suitable for your operating system. Unzip or install that file and the `r`-console will be installed on your machine.

## The basics (the very basics!) {-}

This seminar will cover only the very absolute basics of working in `r`. Designated courses are available at the university and elsewhere as part of summarschools or workshops. Of course, one can learn `r` using the freely available online content. Use YouTube and Google for that. For example, this [online resource](https://r02pro.github.io/) is a good starting point.

The first thing to notice in the `r` console is the symbol `>` followed by the text placer `|`. This specifies the line where to write the `r` code. 

Once the code is written and the key Enter is pressed, the code basically `run`s or is computed by the machine which returns an outcome. (Here the symbol `>` is not visible but the outcome line can be identified through the use of squared brackets[…])

```{r , echo=TRUE}
2+2
```

### Objects

It is useful to work with objects in `r`. That is, whatever code you write, place it into an object and then run the object itself. See below. 

```{r, echo=TRUE}
# no object created
2+2

# object is first created and then run
sum<-2+2
sum
```

Using objects simplifies a lot the work flow because you can combine objects in any way you can imagine!

```{r, echo=TRUE}
# creates a second object called mean
mean<-mean(c(1,2,5,7,8,9))
mean

# and then adds the two objects 'sum' and 'mean' together
result<-sum+mean
result
```

### Vectors

There are multiple types of objects that one can create in `r`. The most important ones are vectors and data tables. 

For simplicity reasons, vectors can be numeric, character strings or logical. A vector is scalable meaning that it can hold up to a gazilion of elements.

```{r, echo=TRUE}
# example of numeric vectors
vec1<-c(1,3,66,9,121)
vec1

# example of character string vector
vec2<-c("A","Ab","This or that","C","d")
vec2

# example of logical vector
vec3<-c(TRUE,TRUE, FALSE, TRUE)
vec3
```

One can do all sorts of things with and to vectors. See for example [here](https://r02pro.github.io/vector.html).

### Data tables

Data tables combine multiple vectors. Data tables can combine all sorts of vectors and can have varying internal structures. When one downloads (or uses one own's) dataset, that is typically a data table in a specific format, `.sav` for SPSS or `.xlsx` for Microsoft Excell. Data formats can also be `.dat`, `.csv`, `.asci` and so on. 

A data table in `r` comprises multiple vectors and involves an organization wherein typically rows represent entries in the data table and columns represent vectors of the data table. In other words, rows represent cases and columns represent variables.

```{r , echo=TRUE}
# create a simple data table
df<-data.frame(col1=vec1,
                  col2=vec2)
df
```

```{r, echo=TRUE}
# one can then access the varying elements of the data table

# access col1
df[,1]

# access first row
df[1,]

# access entry at first row and col1
df[1,1]
```

One can perform all sorts of actions on the data table as a whole or on elements of the data table. 

```{r , echo=TRUE}
# checks the elements of the data table
str(df)
```

One can see that col1 is a numeric `num` vector and col2 is a character string `char` vector.

```{r , echo=TRUE}
# provides a summary of the data table
summary(df)
```

One can see that different summary stats are available for `num` and `chr` vectors. 

```{r , echo=TRUE}
# performs an addition on the numeric vector of the data table
df[,1]+100
```

## Functions {-}

To be entirely honest, `r` functions are something a bit advanced. But, some rudimentary functions can be written by beginners too. The trick is to figure out what is repetitive in the code that one wants to write. This logic proves useful when one needs to apply a command on a number of objects for an undetermined number of times. 

Functions are easy to spot in _R_ because they are labeled as such and have a unique code structure: `function(){}`. 

The rule of thumb is `()` defines the elements that are fed into the function while `{}` contains the function itself. 

Here is an example. We use a dataset that comes pre-installed with _R_ (`iris`), perform an addition on all the numerical variables and then write a function to simplify the task.

```{r, echo=TRUE}
# see the first ten rows of the pre-installed dataset iris
head(iris)
# numerical columns are then columns 1 through 4

# adds 3 to all numerical columns
head(iris[,1:4] + 3)

# add 77 to all numerical columns 
head(iris[,1:4] + 77)

# write a function 
# this function takes two arguments: a dataset 'df' and a constant 'n'
func1<-function(df,n){
  
  tmp <- Filter(is.numeric, df) # we first filter the dataframe for numeric columns
  
  tmp + n # we then add the constant to all the numeric columns
}


# we apply the function and add 3 to all numeric columns of iris
# we only ask to see the first ten rows of the outcome using head()
head(func1(iris,3))

# we apply the function and add 99 to all numeric columns of another pre-installed dataset 'mtcars'
# we only ask to see the first ten rows of the outcome using head()
head(func1(mtcars,99))
```

## Packages {-}

An _R_ package contains code, documentation, and sometimes even data. These packages are developed to serve a specific purpose such as simplifying a work routine or perform advanced computational routines. Packages can be downloaded for free and then immediately used. Of course, everyone can write an _R_ package, which of course is not a easy thing to do. But if at any point and for whatever reason you need to, then know that it is possible.

Everything one needs to know about packages can be found in this [comprehensive book](https://r-pkgs.org/) by Hadley Wickham^[He is THE `r` expert. See [his website](https://hadley.nz/).] and Jennifer Bryan.

`r` packages use the philosophy of working with functions to simplify otherwise highly complex code. Some of the fundamental packages to start with are `tidyverse` (for data preparation and manipulation but also contains several other useful packages like `ggplot2` for creating graphics). Other packages that are the focus of this seminar are `rmarkdown` (the fundamentals of @sec-autom through @sec-apps), `quarto` (needed for self-publishing books and website; covered in @sec-publish),`tinytex` (for latex distributions aka. creating PDFs), `shiny` (for web applications; covered in @sec-apps).

What you absolutely need to know about packages is that the vast majority do not come pre-installed with the `r` console but can be installed by request. Installing any package in _R_ follows this basic routine:

```{r, eval=FALSE,echo=TRUE,message=FALSE}
# installs `tidyverse`
 install.packages("tidyverse") 

# makes it available for R on your local machine
# this step is crucial if you want to have access to all the containing function
library(tidyverse)
```

One trick that I think it is absolutely simple to use but can save you a lot of nerves is using the package `pacman` to install any other packages. The nice thing about it is that `pacman` can first check if a package is already installed on the local machine and if not, it downloads it and installs it from `Cran`. 

We can now install the basic packages needed for the seminar and mentioned above.

```{r, eval=FALSE, echo=TRUE}
# first, we install the `pacman` package
install.packages("pacman")

# then, we use the function `p_load` from the `pacman` package to install `tidyverse`, `rmarkdown`, `shiny` packages
pacman::p_load(tidyverse,rmarkdown,bookdown,quarto,shiny)
```

:::{.callout-tip #tip-package1}
## R Packages with websites
(Almost) Every package has a designated website. Visit the package website for examples on how to use and also to identify the functions contained. For example https://www.tidyverse.org/

:::

:::{.callout-tip #tip-packdoc}
## R Packages documentation
Call the package documentation by typing in a question mark followed by the name of the package or function contained in a package. For example ?tidyverse

:::

Let's see as an example how the function `filter` from the universe of packages `tidyverse` works. Before that, I want to introduce the pipe operator `%>%`^[The pipe operator itself is introduced most comonly in the package `dplyr` contained in the universe of packages `tidyverse`. But, it can be used differently in other packages too.] which is instrumental for `r` users. And it simplifies a lot the work flow!

`%>%` follows the logic of, simply and un-elegantly put, "work that happens in the background until the desired output is retrieved". It also means that using ` %>% ` you can compress into one code otherwise a long chain of steps that involve creating objects which are then subjected to new operations.

```{r, echo=TRUE}
# apply the function filter to the dataset mtcars
# we filter the column cyl such that only cars with a cyl < 5 are displayed
head(mtcars)

mtcars %>% filter(cyl < 5)

# we filter the column cyl such that only cars with a cyl exactly equal to 8 are displayed
mtcars %>% filter(cyl == 8)
```

As an example of the usefulness of the pipeline operator ` %>% `, let us apply a double filter. First, on the column `cyl` and then on the column horse power `hp`. 

```{r, echo=TRUE}
# without the pipeline operator
a<-mtcars %>% filter(cyl < 5)
b<-a %>% filter(hp > 100)
b

# with the pipeline operator
mtcars %>% filter(cyl < 5) %>% filter(hp > 100)
```

Of course, this example is too simplistic but imagine having to write a gazillion of lines of code when you could reduce that to a couple. Throughout the seminar we use the pipe operator ` %>% ` almost everywhere!

## Base R vs. Packages {-}

![](img/decision.jpg){.lightbox width=50% #fig-decision}

A fair warning! 

Base _R_ is complex but stable. Packages are simple to use but depend on the community for their maintenance. So, the decision is to use something complex but stable or simple but unstable. 

For the purpose of this seminar, and for most of the things a regular _R_-user needs, working with packages is indeed the way to go. 

If at any point, you are concerned that the package(s) you use can get outdated, I recommend using the [sic!] package `groundhog` which ensures reproducible code. This package basically goes back in time and installs on the local machine the desired version of the package. 

See how it works on this [website](https://groundhogr.com/).

## RStudio {-}

![RStudio panels](img/rstudpanels.png){.lightbox width=75% #fig-rstudio}

In @fig-rstudio you can see the four panels of `RStudio`, the (a) Console/terminal, (b) Source, (c) Environment/history, and (d) Files/plot/packages/help.

- **a) Console/terminal** Here is where the `r` console is integrated in `RStudio`. You can type in your code, have your results previewed, as well as any errors (those happen quite a lot) that occur in your coding. 

- **b) Source** This panel is where we will do most of the work throughout the seminar. Think of this panel as the notebook -- you write, you draw, you comment on your own work, etc. This panel allows you to communicate with the source material, which can be `r` (the language), `html` (the language) and also lets you populate with content the files needed for the website, for instance.

- **c) Environment/history** This panel is a place where you can see the history of your work. It saves for you the code you ran (either in the console or source panels) and also it contains sort of short-cuts to any data-related work you might have done.

- **d) Files/plot/packages/help** This panel allows you to preview what you've communicated to the machine (laptop) to do. You will note there are several tabs, but the most important one for the seminar are:

  + `Files` is sort of *Windows explorer* in Windows or *Finder* on Mac OS. It is here that you can navigate between folders on the local machine, delete, rename, or more. Here you can also open files in the source panel.
  + `Packages` gives you an overview of packages that are installed and active on the local machine. 
  + `Help` is, well, where you will see helpful information about a function or package. 

On [this youtube channel](https://www.youtube.com/watch?v=lVKMsaWju8w) there is a helpful beginners guide on _R_ and `RStudio`. Take some time to familiarize yourself with them.

:::{.callout-tip #tip-rres}
## Learning resources
If your `RStudio` version is 2024.04. or newer, you should note in the Environment/ History panel a tab "Turorial". That panel contains tutorials for working in _R_. Install first the package `learnr` as indicated and let yourself guided through a number of interactive exercises.
:::

## Advanced resources {-}

Together with a colleague, [Dr. Ranjit SINGH](https://www.gesis.org/en/institute/about-us/staff/person/Ranjit.Singh) from GESIS - Leibniz Institute for the Social Sciences, I prepared a workshop on `r` for beginners. All the material is open access via `GitHub`. 

You can `clone` the repository on your local machine and do all the exercises.

Navigate first to the page of the repository and then `clone` it to your local machine: https://github.com/adrianvstanciu/rworkshop_open.


